# 0 前言


# 1 什么是二维码

二维码 （2-dimensional bar code），是用某种特定的几何图形按一定规律在平面（二维方向上）分布的黑白相间的图形记录数据符号信息的。

在许多种类的二维条码中，常用的码制有：Data Matrix, Maxi Code, Aztec, QR Code, Vericode, PDF417, Ultracode, Code 49, Code 16K等。

二维条码/二维码可以分为堆叠式/行排式二维条码和矩阵式二维条码。

1.堆叠式/行排式二维条码，堆叠式/行排式二维条码又称堆积式二维条码或层排式二维条码，其编码原理是建立在一维条码基础之上，按需要堆积成二行或多行。它在编码设计、校验原理、识读方式等方面继承了一维条码的一些特点，识读设备与条码印刷与一维条码技术兼容。但由于行数的增加，需要对行进行判定，其译码算法与软件也不完全相同于一维条码。有代表性的行排式二维条码有：Code 16K、Code 49、PDF417、MicroPDF417 等。

2.矩阵式二维码，最流行莫过于QR CODE ,我们常说的二维码就是它了。矩阵式二维条码（又称棋盘式二维条码）它是在一个矩形空间通过黑、白像素在矩阵中的不同分布进行编码。在矩阵相应元素位置上，用点（方点、圆点或其他形状）的出现表示二进制“1”，点的不出现表示二进制的“0”，点的排列组合确定了矩阵式二维条码所代表的意义。矩阵式二维条码是建立在计算机图像处理技术、组合编码原理等基础上的一种新型图形符号自动识读处理码制。具有代表性的矩阵式二维条码有：Code One、MaxiCode、QR Code、 Data Matrix、Han Xin Code、Grid Matrix 等。

二维码在现实生活中的应用越来越普遍由于QR CODE的流行，二维码又称QR code。

# 2 QR码的特点

## 1.存储大容量信息

传统的条形码只能处理20位左右的信息量，与此相比，QR码可处理条形码的几十倍到几百倍的信息量。

另外，QR码还可以支持所有类型的数据。（如：数字、英文字母、日文字母、汉字、符号、二进制、控制码等）。一个QR码最多可以处理7089字(仅用数字时)的巨大信息量。

## 2.在小空间内打印

QR码使用纵向和横向两个方向处理数据，如果是相同的信息量，QR码所占空间为条形码的十分之一左右。(还支持Micro QR码，可以在更小空间内处理数据。)
![这里写图片描述](http://img.blog.csdn.net/20161115012522086)

## 3.有效表现各种字母

QR码是日本国产的二维码，因此非常适合处理日文字母和汉字。QR码字集规格定义是按照日本标准“JIS第一级和第二级的汉字”制定的，因此在日语处理方面，每一个全角字母和汉字都用13比特的数据处理，效率较高，与其他二维码相比，可以多存储20%以上的信息。
![这里写图片描述](http://img.blog.csdn.net/20161115012657365)

## 4.对变脏和破损的适应能力强

QR码具备“纠错功能”，即使部分编码变脏或破损，也可以恢复数据。数据恢复以码字为单位（是组成内部数据的单位，在QR码的情况下，每8比特代表1码字），最多可以纠错约30%（根据变脏和破损程度的不同，也存在无法恢复的情况）。

## 5.可以从任意方向读取

QR码从360°任一方向均可快速读取。其奥秘就在于QR码中的3处定位图案，可以帮助QR码不受背景样式的影响，实现快速稳定的读取。
![这里写图片描述](http://img.blog.csdn.net/20161115013021822)

## 6.支持数据合并功能

QR码可以将数据分割为多个编码，最多支持16个QR码。使用这一功能，还可以在狭长区域内打印QR码。另外，也可以把多个分割编码合并为单个数据。
![这里写图片描述](http://img.blog.csdn.net/20161115013138151)

# 3 QR码的信息量和版本

QR码设有1到40的不同版本（种类)，每个版本都具备固有的码元结构(码元数)。（码元是指构成QR码的方形黑白点。)

“码元结构”是指二维码中的码元数。从版本1(21码元×21码元)开始，在纵向和横向各自以4码元为单位递增，一直到版本40(177码元×177码元)。
![这里写图片描述](http://img.blog.csdn.net/20161118012034759)

QR码的各个版本结合数据量、字符类型和纠错级别，均设有相对应的最多输入字符数。也就是说，如果增加数据量，则需要使用更多的码元来组成QR码，QR码就会变得更大。

例如，需要输入的数据为100位的数字时，通过以下步骤来选定。 
1．假设要输入的数据种类为“数字” 
2．从“L”“M”“Q”“H”中选择纠错级别。（假设选择“M”） 
3．查看下表，先从数字列找出数字为100以上且接近100的，其次找出纠错级别“M”，两者交叉的部分就是最佳版本。
![这里写图片描述](http://img.blog.csdn.net/20161118012351591)

通过下面的计算为每个字符类型，总比特数的计算方法。 
![这里写图片描述](http://img.blog.csdn.net/20161118090915379)

# 4 QR码的纠错
QR码具有“纠错功能”。即使编码变脏或破损，也可自动恢复数据。这一“纠错能力”具备4个级别，用户可根据使用环境选择相应的级别。调高级别，纠错能力也相应提高，但由于数据量会随之增加，编码尺寸也也会变大。 
用户应综合考虑使用环境、编码尺寸等因素后选择相应的级别。 在工厂等容易沾染赃物的环境下，可以选择级别Q或H，在不那么脏的环境下，且数据量较多的时候，也可以选择级别L。一般情况下用户大多选择级别M(15%)。 
![这里写图片描述](http://img.blog.csdn.net/20161118091154209)
纠错级别的比率，是指全部码字与可以纠错的码字的比率。 
例如，需要编码的码字数据有100个，并且想对其中的一半，也就是50个码字进行纠错，则计算方法如下。纠错需要相当于码字2倍的符号（RS编码※），因此在这种情况下的数量为50个×2＝100码字。因此，全部码字数量为200个，其中用作纠错的码字为50个，所以计算得出，相对于全部码字的纠错率就是25%。这一比率相当于QR码纠错级别中的“Q”级别。

另外，在上述例子当中，也可以认为相对于码字数据的纠错率为50%，但变脏或破损的部位不仅仅局限于码字数据部分，因此，在QR码中，还是用相对于全部码字的比率来描述纠错率。

※ RS编码：QR码的纠错功能是通过将RS编码附加到原数据中的方式实现的。RS编码是应用于音乐CD等用途的数学纠错方法。它能以字节为单位进行纠错，适合用于错误位置会集中的突发错误。

# 5 QR码的种类
![这里写图片描述](http://img.blog.csdn.net/20161119011115300)

# 6 QR码的基本结构
QR(Quick-Response) code是被广泛使用的一种二维码，解码速度快。它可以存储多用类型，下图是qrcode的基本结构：
![这里写图片描述](http://img.blog.csdn.net/20161126233946256)
位置探测图形、位置探测图形分隔符、定位图形：用于对二维码的定位，对每个QR码来说，位置都是固定存在的，只是大小规格会有所差异； 
校正图形：规格确定，校正图形的数量和位置也就确定了； 
格式信息：表示改二维码的纠错级别，分为L、M、Q、H；

版本信息：即二维码的规格，QR码符号共有40种规格的矩阵（一般为黑白色），从21x21（版本1），到177x177（版本40），每一版本符号比前一版本 每边增加4个模块。

数据和纠错码字：实际保存的二维码信息，和纠错码字（用于修正二维码损坏带来的错误）。

# 7 QR码的编码过程

下面是简要QR编码过程：

1.数据分析：确定编码的字符类型，按相应的字符集转换成符号字符； 选择纠错等级，在规格一定的条件下，纠错等级越高其真实数据的容量越小。

2.数据编码：将数据字符转换为位流，每8位一个码字，整体构成一个数据的码字序列。其实知道这个数据码字序列就知道了二维码的数据内容。

容量如下：

格式	| 容量
-|-
数字	| 最多7089字符
字母	| 最多4296字符
二进制数（8 bit）	| 最多2953字节
日文汉字/片假名	| 最多1817字符（采用Shift JIS）
中文汉字	| 最多984字符（采用UTF-8）
中文汉字	| 最多1800字符（采用BIG5）

模式编码如下：

模式	| 指示符
-|-
ECI	| 0111
数字	| 0001
字母数字	| 0010
8位字节	| 0100
日本汉字	| 1000
中文汉字	| 1101
结构链接	| 0011
FNCI	| 0101（第一位置）
1001 | （第二位置）
终止符（信息结尾）	| 0000

数据可以按照一种模式进行编码，以便进行更高效的解码，例如：对数据：01234567编码（版本1-H）， 
1）分组：012 345 67 
2）转成二进制： 
012→0000001100 
345→0101011001 
67 →1000011 
3）转成序列：0000001100 0101011001 1000011 
4）字符数 转成二进制：8→0000001000 
5）加入模式指示符（上图数字）0001：0001 0000001000 0000001100 0101011001 1000011

对于字母、中文、日文等只是分组的方式、模式等内容有所区别。基本方法是一致的。

3.纠错编码：按需要将上面的码字序列分块，并根据纠错等级和分块的码字，产生纠错码字，并把纠错码字加入到数据码字序列后面，成为一个新的序列。

纠错等级 |	纠错水平
-|-
L	| 7%字码修正
M	| 15%字码修正
Q	| 25%字码修正
H	| 30%字码修正
在二维码规格和纠错等级确定的情况下，其实它所能容纳的码字总数和纠错码字数也就确定了，比如：版本10，纠错等级时H时，总共能容纳346个码字，其中224个纠错码字。

就是说二维码区域中大约1/3的码字时冗余的。对于这224个纠错码字，它能够纠正112个替代错误（如黑白颠倒）或者224个据读错误（无法读到或者无法译码），这样纠错容量为：112/346=32.4%。

4.构造最终数据信息：在规格确定的条件下，将上面产生的序列按次序放如分块中。

按规定把数据分块，然后对每一块进行计算，得出相应的纠错码字区块，把纠错码字区块 按顺序构成一个序列，添加到原先的数据码字序列后面。 
如：D1, D12, D23, D35, D2, D13, D24, D36, … D11, D22, D33, D45, D34, D46, E1, E23,E45, E67, E2, E24, E46, E68，…

5.构造矩阵：将探测图形、分隔符、定位图形、校正图形和码字模块放入矩阵中。

# 8 QR码的应用

QR码可以很“方便”地应用于各种场合。除了传单和名片等印刷物之外，还可以应用于各种广泛领域，如结算系统等与生活息息相关的领域以及工厂、流通等各种商业领域。QR码已经成为日常生活不可或缺的工具。2012年，公益财团法人日本设计振兴会对QR码表示了高度评价，由于QR码的功能非常贴近生活，设计精致，在其主办的设计推荐制度中授予QR码“优秀设计奖”。

# 9 QR码的标准化

“想让更多人使用QR码”，秉承这一理念，DENSO WAVE全面公开了QR码的相关标准。目前，QR码已经在国家标准和国际标准中实现标准化，任何人都可以随意查看该标准。

※DENSO WAVE INCORPORATED已宣布，不行使本公司就标准QR码拥有的专利权(专利第2938338号)。

1997年 10月 被采纳为AIM International(国际自动识别工业会)标准（ISS - QR Code） 
1998年 3月 被采纳为JEIDA（日本电子工业振兴协会）标准（JEIDA-55） 
1999年 1月 被采纳为JIS（日本工业标准）（JIS X 0510） 
2000年 6月 被采纳为ISO国际标准 (ISO/IEC18004) 
2004年 11月 Micro QR码被采纳为JIS（日本工业标准）（JIS X 0510） 
2011年 12月 国际标准化组织GS1将QR码采纳为面向移动终端的标准

QR码的简要标准 
![这里写图片描述](http://img.blog.csdn.net/20161118235443483)

# QR码标准文件下载

QR码在ISO(ISO/IEC18004)中得到 标准化。因此，请从以下团体的网站购买QR码标准文件，在下面网址中搜索18004。

http://www.iso.ch/iso/en/prods-services/ISOstore/store.html

不过2016标准版的价格略贵，可到本人的资源中下载2006标准版的，链接如下：

http://download.csdn.net/detail/u012611878/9687105

另外，这里提供一个c++编写的qrcode编码解码工具，基于zxing的编码库，libqrcode的解码库，通过命令行完成二维码图片与文本之间的相互转换，链接如下：

http://download.csdn.net/detail/u012611878/9705048

欢迎下崽。

# 开源项目
[zxing/zxing](https://github.com/zxing/zxing)
[oostendo/python-zxing](https://github.com/oostendo/python-zxing)
[ZBar/ZBar](https://github.com/ZBar/ZBar)
[Polyconseil/zbarlight](https://github.com/Polyconseil/zbarlight)

# 参考资料
[二维码的生成和解析原理](http://blog.csdn.net/kelindame/article/details/45155185)
[二维码（QR code）基本结构及生成原理](http://blog.csdn.net/u012611878/article/details/53167009)
[二维码的生成细节和原理](http://developer.51cto.com/art/201310/414082_all.htm)